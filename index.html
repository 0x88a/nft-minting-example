<!DOCTYPE html>
<html lang="en">
<head>
		<title> NFT Generation </title>
		<script src="./js/jquery.js"></script>
		<script src="./js/web3.js"></script>
		<script src="https://unpkg.com/konva@8/konva.min.js"></script>
		<style>
			.header {
				margin-bottom: 12px;
			}
			
		</style>
</head>

<body>
	<div class="header">
		<b> NFT Generation Example </b> <br>
		<i> This website is a demonstration of automatic NFT Generation. <br>
		It aims to be able to create NFTs randomly, asign meta data and retrieve NFT info such as owner, rarity & traits through either a unique hash or meta tags </i>
	</div>
	<div class="body">
		<div class="form" style="width: 900px">
			<div style="width: 40%">
				<input id="address_nft" placeholder="Address" style="width: 100%" readonly disabled /> <br>
				<input id="balance_nft" placeholder="Balance" style="width: 100%" readonly disabled /> <br>
				<button id="init_nft" style="width: 102%"> Initialise Wallet </button> <br>
				<button id="mint_nft" style="width: 102%"> Mint </button>
			</div>
			<br>
			<div style="width: 50%">
				<input id="input_nft" placeholder="Image Hash" style="width: 60%" />
				<button id="generate_nft" style="width: 18%"> Generate </button>
			</div>
		</div>
		
		<div id="image_nft" style="margin-top: 12px;"></div>
		<div id="log"></div>
	</div>
</body>
</html>

<script>
	<!-- load our web3 stuff -->
    async function f() {
        web3 = new Web3(Web3.givenProvider); // provider from metamask         
		var result=await web3.eth.requestAccounts().catch();
        var acts=await web3.eth.getAccounts().catch();
		var balance = await web3.eth.getBalance(result[0]);
		balance = web3.utils.fromWei (balance, 'ether');
		
		$("#address_nft").val(result[0]);
		$("#balance_nft").val(balance + " ETH");
	}
	<!-- end -->
	
	function random_number(lower, upper) {
		return Math.floor(Math.random() * (upper - lower) + lower);
	}

	<!-- These functions would be done server-end -->
	function return_data(hash) {
		hash = hash.toString();
		let text = [];
		const values = ["nil", "New York", "London", "Warsaw", "Berlin", "Paris", "Beijing", "Tokyo", "Prague", "Athens"];
		// Loop through each number in our hash and asign a value to it.
		for (var i = 0; i < hash.length; i++) {
			text.push(values[hash.charAt(i)]);
		}
		return text;
	}
	
	// Generate a list of non-repeating numbers
	function generate_hash() {
		var nums = [1,2,3,4,5,6,7,8,9],
			ranNums = [],
			i = nums.length,
			j = 0;

		while (i--) {
			j = Math.floor(Math.random() * (i + 1));
			ranNums.push(nums[j]);
			nums.splice(j,1);
		}
		
		var hash = ranNums[0];
		for (e = 1; e < ranNums.length; e++) {
			hash = hash + (ranNums[e] * (Math.pow(10, e)));
		}
		
		return hash;
		
	}
	<!-- End server-end functions -->
	
	$("#init_nft").click(function() {
		f(); // initialise our wallet
		
	});
	
	$("#generate_nft").click(function() {
		if ($("#input_nft").val() == "") {
			var hash = generate_hash();
		} else {
			var hash = $("#input_nft").val();
		}
		var nft_data = return_data(hash);
		
		var stage = new Konva.Stage({
			container: 'image_nft',
			width: 256,
			height: 256,
		});

		var layer = new Konva.Layer();

		var back = new Konva.Rect({
			x: 0,
			y: 0,
			width: 4096,
			height: 4096,
			fill: 'black',
		});
		
		layer.add(back);

		for (var i = 0; i < nft_data.length; i++) {
			var d = new Konva.Text({
				x: 6,
				y: 6 + (i * 14),
				text: nft_data[i],
				fontSize: 13,
				fontFamily: 'Calibri',
				fill: '#f4f4f4',
			});
			layer.add(d);
		}
		
		var watermark_hash = new Konva.Text({
			x: 6,
			y: 243,
			text: hash,
			fontSize: 13,
			fontFamily: 'Calibri',
			fill: '#f4f4f4',
		});
		
		layer.add(watermark_hash);
	  
		stage.add(layer);
	});
</script>